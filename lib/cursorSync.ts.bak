// lib/cursorSync.ts - Cursor broadcasting with different throttling for local vs remote cursors.

import { getCollaborationManager } from './collaboration'
import type { Point } from './types'

let lastBroadcast = 0
const REMOTE_THROTTLE_MS = 50 // ~20fps for remote cursors to reduce server load

// For local cursor - no throttling for smooth monitor refresh rate movement
export function broadcastCursorLocal(position: Point) {
  const manager = getCollaborationManager()
  if (manager) {
    manager.broadcastCursor(position)
  }
}

// For remote cursors - throttled to reduce server load while remaining smooth
export function broadcastCursorThrottled(position: Point) {
  const now = Date.now()
  if (now - lastBroadcast >= REMOTE_THROTTLE_MS) {
    lastBroadcast = now
    const manager = getCollaborationManager()
    if (manager) {
      manager.broadcastCursor(position)
    }
  }
}

// Optional: Add interpolation for smoother cursor movement on clients
export function interpolateCursor(from: Point, to: Point, progress: number): Point {
  return {
    x: from.x + (to.x - from.x) * progress,
    y: from.y + (to.y - from.y) * progress
  }
}
